import { BaseBoxShapeUtil, HTMLContainer, useDefaultColorTheme } from 'tldraw'
import { Shapes } from 'editor-common'
import { BaseShape, figureStyles } from './index.ts'
import { TextLabelWithAutoHeight } from './util/TextLabelWithAutoHeight.tsx'

const shapeType = Shapes.serviceCall
type ShapeType = BaseShape<typeof shapeType>

const DEFAULT_WIDTH = 300
const MIN_HEIGHT = 150
const ICON_HEIGHT = 63

export default class extends BaseBoxShapeUtil<ShapeType> {
  static override type = shapeType.name
  static override props = shapeType.props

  override getDefaultProps(): ShapeType['props'] {
    return {
      h: MIN_HEIGHT,
      w: DEFAULT_WIDTH,
      text: 'Serivce Call..',
      color: 'light-green',
    }
  }

  override canEdit = () => true
  override hideSelectionBoundsFg = () => true
  override hideResizeHandles = () => false
  override canResize = () => true

  override component(shape: ShapeType) {
    const isSelected = shape.id === this.editor.getOnlySelectedShapeId()
    const theme = useDefaultColorTheme()

    return (
      <HTMLContainer
        style={{
          background: theme[shape.props.color].solid,
          border: figureStyles.border,
          padding: '1rem',
          borderRadius: '10px',
          display: 'flex',
          flexDirection: 'column',
          justifyContent: 'center',
          alignItems: 'center',
        }}
      >
        <svg
          width="36"
          height="36"
          viewBox="0 0 36 36"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M19.0622 1L16.9372 1C15.8747 1 14.8123 1.31874 14.8123 3.125V3.12501C14.8123 4.825 14.8123 5.25 13.7497 6.3125C12.6873 7.375 11.4123 7.1625 10.5623 6.3125C9.4998 5.25 8.43732 4.1875 7.37484 5.25L5.24987 7.375C4.89571 7.72917 4.39989 8.65 5.24987 9.5C6.31234 10.5625 7.37487 11.625 6.31241 13.75C5.7679 14.839 4.44801 14.8253 3.41393 14.8145C3.31466 14.8135 3.21803 14.8125 3.12496 14.8125C2.06248 14.8125 1 15.2375 1 16.9375V19.0625C1 19.4167 1 21.1875 3.12496 21.1875C4.82494 21.1875 5.24993 21.1875 6.31241 22.2501C7.37489 23.3125 7.1624 24.5876 6.31241 25.4376C5.24993 26.5001 4.18745 27.5626 5.24993 28.6251L7.37489 30.7501C7.72905 31.1042 8.64987 31.6001 9.49985 30.7501C10.5623 29.6876 11.6249 28.625 13.7498 29.6875C14.8388 30.232 14.8251 31.5519 14.8143 32.586C14.8133 32.6853 14.8123 32.7819 14.8123 32.875C14.8123 33.9375 15.2373 35 16.9372 35L19.0622 35C21.1872 35 21.1872 33.9375 21.1872 32.875C21.1872 31.175 21.1872 30.75 22.2497 29.6875C23.3122 28.625 24.5872 28.8375 25.4372 29.6875C26.4997 30.75 27.5622 31.8125 28.6246 30.75L30.7496 28.625C31.1038 28.2708 31.5996 27.35 30.7496 26.5C29.6871 25.4375 28.6246 24.375 29.6871 22.25C30.2269 21.1702 30.8419 21.1745 32.3625 21.1852C32.5228 21.1863 32.6931 21.1875 32.8745 21.1875C34.4276 21.1875 34.8611 20.4792 34.968 19.0625C35.0022 18.6086 35.0005 17.6143 34.9997 17.1088C34.9996 17.0425 34.9995 16.9847 34.9995 16.9375C34.9995 16.5833 34.9995 14.8125 32.8745 14.8125C31.1745 14.8125 30.7495 14.8125 29.6871 13.7499C28.6246 12.6875 28.8371 11.4124 29.6871 10.5624C30.7495 9.49995 31.812 8.43745 30.7495 7.37495L28.6246 5.24995C28.2704 4.89578 27.3496 4.39995 26.4996 5.24995C25.4371 6.31243 24.3746 7.37498 22.2497 6.3125C21.1607 5.76798 21.1744 4.44807 21.1852 3.41398C21.1862 3.31471 21.1872 3.21807 21.1872 3.125C21.1872 2.0625 20.7622 1 19.0622 1ZM18 25.0833C21.912 25.0833 25.0833 21.912 25.0833 18C25.0833 14.088 21.912 10.9167 18 10.9167C14.088 10.9167 10.9167 14.088 10.9167 18C10.9167 21.912 14.088 25.0833 18 25.0833Z"
            fill="white"
          />
          <path
            d="M16.9372 1L16.9372 0H16.9372V1ZM19.0622 1L19.0622 2L19.0622 2L19.0622 1ZM13.7497 6.3125L13.0426 5.60538L13.0426 5.60542L13.7497 6.3125ZM10.5623 6.3125L9.85517 7.0196L9.85517 7.0196L10.5623 6.3125ZM7.37484 5.25L6.66772 4.5429L6.66772 4.5429L7.37484 5.25ZM5.24987 7.375L5.95699 8.0821L5.95699 8.0821L5.24987 7.375ZM5.24987 9.5L4.54276 10.2071L4.54276 10.2071L5.24987 9.5ZM6.31241 13.75L5.41798 13.3028L5.41798 13.3028L6.31241 13.75ZM3.41393 14.8145L3.42434 13.8146L3.42434 13.8146L3.41393 14.8145ZM6.31241 22.2501L5.60528 22.9571L5.60531 22.9572L6.31241 22.2501ZM6.31241 25.4376L7.01952 26.1447L7.01952 26.1447L6.31241 25.4376ZM5.24993 28.6251L5.95704 27.918L5.95704 27.918L5.24993 28.6251ZM7.37489 30.7501L6.66778 31.4572L6.66778 31.4572L7.37489 30.7501ZM9.49985 30.7501L10.207 31.4572L10.207 31.4572L9.49985 30.7501ZM13.7498 29.6875L14.197 28.7931L13.7498 29.6875ZM14.8143 32.586L13.8144 32.5756L13.8144 32.5756L14.8143 32.586ZM16.9372 35L16.9372 34H16.9372V35ZM19.0622 35L19.0622 36H19.0622V35ZM22.2497 29.6875L22.9568 30.3946L22.9569 30.3946L22.2497 29.6875ZM25.4372 29.6875L26.1443 28.9804L25.4372 29.6875ZM30.7496 28.625L30.0425 27.9179L30.0425 27.9179L30.7496 28.625ZM30.7496 26.5L30.0425 27.2071L30.0425 27.2071L30.7496 26.5ZM29.6871 22.25L28.7926 21.8028L28.7926 21.8028L29.6871 22.25ZM32.3625 21.1852L32.3555 22.1852L32.3555 22.1852L32.3625 21.1852ZM34.968 19.0625L35.9651 19.1377L35.9651 19.1377L34.968 19.0625ZM34.9997 17.1088L33.9997 17.1105L33.9997 17.1105L34.9997 17.1088ZM32.8745 14.8125L32.8745 13.8125H32.8745V14.8125ZM29.6871 13.7499L30.3942 13.0429L30.3942 13.0428L29.6871 13.7499ZM29.6871 10.5624L28.9799 9.85535L28.9799 9.85535L29.6871 10.5624ZM30.7495 7.37495L31.4567 6.66785L31.4567 6.66785L30.7495 7.37495ZM28.6246 5.24995L27.9175 5.95705L27.9175 5.95705L28.6246 5.24995ZM26.4996 5.24995L25.7925 4.54285L25.7925 4.54285L26.4996 5.24995ZM22.2497 6.3125L22.6969 5.41808L22.6969 5.41808L22.2497 6.3125ZM21.1852 3.41398L20.1852 3.40357L20.1852 3.40357L21.1852 3.41398ZM16.9372 2L19.0622 2L19.0622 2.02656e-06L16.9372 0L16.9372 2ZM15.8123 3.125C15.8123 2.42185 16.0096 2.23634 16.0847 2.17875C16.2152 2.07873 16.4686 2 16.9372 2V0C16.3433 0 15.5343 0.0806424 14.8679 0.591549C14.1461 1.1449 13.8123 2.02189 13.8123 3.125H15.8123ZM15.8123 3.12501V3.125H13.8123V3.12501H15.8123ZM14.4568 7.01962C15.0292 6.44723 15.4354 5.93156 15.6388 5.23999C15.8216 4.61849 15.8123 3.91829 15.8123 3.12501H13.8123C13.8123 4.03172 13.8029 4.39402 13.7201 4.67564C13.6579 4.8872 13.5328 5.11527 13.0426 5.60538L14.4568 7.01962ZM9.85517 7.0196C10.423 7.58743 11.1794 7.98811 12.0288 8.02856C12.8988 8.06999 13.7493 7.72716 14.4569 7.01958L13.0426 5.60542C12.6877 5.96034 12.3695 6.04251 12.1239 6.03082C11.8577 6.01814 11.5516 5.88757 11.2694 5.6054L9.85517 7.0196ZM8.08195 5.9571C8.2253 5.81375 8.29528 5.81069 8.29573 5.81064C8.30705 5.80922 8.37106 5.80366 8.52134 5.8788C8.87576 6.05601 9.28383 6.44825 9.85517 7.0196L11.2694 5.6054C10.7782 5.11425 10.1238 4.44399 9.41578 4.08995C9.03481 3.89946 8.56758 3.76109 8.04766 3.82608C7.51687 3.89243 7.05562 4.155 6.66772 4.5429L8.08195 5.9571ZM5.95699 8.0821L8.08195 5.9571L6.66772 4.5429L4.54276 6.6679L5.95699 8.0821ZM5.95699 8.7929C5.84544 8.68135 5.80822 8.59921 5.79408 8.55495C5.77967 8.50984 5.77677 8.46477 5.78533 8.41224C5.7946 8.35529 5.81778 8.28971 5.85509 8.22255C5.89311 8.15412 5.93434 8.10475 5.95699 8.0821L4.54276 6.6679C4.25253 6.95814 3.91417 7.45901 3.81131 8.09089C3.69835 8.78478 3.88731 9.55164 4.54276 10.2071L5.95699 8.7929ZM7.20684 14.1972C7.83975 12.9314 7.89805 11.8341 7.50646 10.8552C7.15088 9.96624 6.45587 9.2918 5.95699 8.7929L4.54276 10.2071C5.10634 10.7707 5.47383 11.1588 5.64951 11.598C5.78919 11.9471 5.84753 12.4437 5.41798 13.3028L7.20684 14.1972ZM3.40353 15.8145C3.89459 15.8196 4.61509 15.8328 5.28847 15.665C6.00122 15.4875 6.7646 15.0817 7.20684 14.1972L5.41798 13.3028C5.31571 13.5073 5.14689 13.6392 4.80504 13.7243C4.42384 13.8193 3.96735 13.8202 3.42434 13.8146L3.40353 15.8145ZM3.12496 15.8125C3.2119 15.8125 3.3032 15.8134 3.40353 15.8145L3.42434 13.8146C3.32612 13.8136 3.22416 13.8125 3.12496 13.8125V15.8125ZM2 16.9375C2 16.3082 2.1856 16.1009 2.28875 16.0184C2.43451 15.9018 2.70057 15.8125 3.12496 15.8125V13.8125C2.48688 13.8125 1.69045 13.9357 1.03935 14.4566C0.345643 15.0116 0 15.8668 0 16.9375H2ZM2 19.0625V16.9375H0V19.0625H2ZM3.12496 20.1875C2.73441 20.1875 2.51465 20.1071 2.39434 20.038C2.27681 19.9705 2.20041 19.8833 2.14352 19.779C2.00969 19.5336 2 19.2309 2 19.0625H0C0 19.2482 -0.00969255 20.0081 0.387722 20.7367C0.596449 21.1193 0.918487 21.4969 1.3986 21.7725C1.87593 22.0466 2.45304 22.1875 3.12496 22.1875V20.1875ZM7.01954 21.543C6.44717 20.9706 5.93149 20.5644 5.23993 20.361C4.61843 20.1782 3.91824 20.1875 3.12496 20.1875V22.1875C4.03166 22.1875 4.39395 22.1968 4.67556 22.2797C4.88711 22.3419 5.11517 22.467 5.60528 22.9571L7.01954 21.543ZM7.01952 26.1447C7.58735 25.5768 7.98801 24.8204 8.02845 23.971C8.06988 23.101 7.72707 22.2505 7.0195 21.5429L5.60531 22.9572C5.96023 23.3121 6.04241 23.6303 6.03072 23.8759C6.01804 24.1422 5.88746 24.4483 5.6053 24.7305L7.01952 26.1447ZM5.95704 27.918C5.81369 27.7746 5.81063 27.7046 5.81057 27.7041C5.80916 27.6928 5.8036 27.6288 5.87874 27.4785C6.05595 27.1241 6.44819 26.716 7.01952 26.1447L5.6053 24.7305C5.11415 25.2216 4.44391 25.876 4.08988 26.5841C3.8994 26.9651 3.76103 27.4323 3.82602 27.9522C3.89236 28.483 4.15492 28.9443 4.54282 29.3322L5.95704 27.918ZM8.082 30.043L5.95704 27.918L4.54282 29.3322L6.66778 31.4572L8.082 30.043ZM8.79274 30.043C8.68119 30.1545 8.59906 30.1917 8.55481 30.2059C8.5097 30.2203 8.46464 30.2232 8.41212 30.2146C8.35518 30.2053 8.28961 30.1822 8.22245 30.1448C8.15402 30.1068 8.10465 30.0656 8.082 30.043L6.66778 31.4572C6.95801 31.7474 7.45887 32.0858 8.09076 32.1886C8.78466 32.3016 9.55152 32.1126 10.207 31.4572L8.79274 30.043ZM14.197 28.7931C12.9312 28.1601 11.8339 28.1018 10.855 28.4934C9.96606 28.849 9.29163 29.5441 8.79274 30.043L10.207 31.4572C10.7705 30.8936 11.1586 30.5261 11.5978 30.3504C11.947 30.2107 12.4435 30.1524 13.3026 30.5819L14.197 28.7931ZM15.8142 32.5964C15.8194 32.1054 15.8325 31.3849 15.6648 30.7115C15.4873 29.9987 15.0815 29.2353 14.197 28.7931L13.3026 30.5819C13.5071 30.6842 13.639 30.853 13.7241 31.1949C13.8191 31.5761 13.82 32.0326 13.8144 32.5756L15.8142 32.5964ZM15.8123 32.875C15.8123 32.7881 15.8132 32.6968 15.8142 32.5964L13.8144 32.5756C13.8133 32.6738 13.8123 32.7758 13.8123 32.875H15.8123ZM16.9372 34C16.308 34 16.1007 33.8144 16.0181 33.7112C15.9015 33.5655 15.8123 33.2994 15.8123 32.875H13.8123C13.8123 33.5131 13.9355 34.3095 14.4564 34.9606C15.0113 35.6543 15.8665 36 16.9372 36V34ZM19.0622 34L16.9372 34L16.9372 36L19.0622 36L19.0622 34ZM20.1872 32.875C20.1872 33.1546 20.1856 33.3517 20.1628 33.5231C20.141 33.6863 20.1075 33.7542 20.0895 33.7812C20.0817 33.793 20.0547 33.8362 19.9283 33.8854C19.7837 33.9416 19.5191 34 19.0622 34V36C20.2568 36 21.2131 35.7015 21.7536 34.8906C22.2198 34.1914 22.1872 33.3199 22.1872 32.875H20.1872ZM21.5426 28.9804C20.9702 29.5528 20.5641 30.0684 20.3607 30.76C20.1779 31.3815 20.1872 32.0817 20.1872 32.875H22.1872C22.1872 31.9683 22.1966 31.606 22.2794 31.3244C22.3416 31.1128 22.4667 30.8847 22.9568 30.3946L21.5426 28.9804ZM26.1443 28.9804C25.5765 28.4126 24.8201 28.0119 23.9707 27.9714C23.1006 27.93 22.2501 28.2728 21.5426 28.9804L22.9569 30.3946C23.3118 30.0397 23.63 29.9575 23.8756 29.9692C24.1418 29.9819 24.4479 30.1124 24.7301 30.3946L26.1443 28.9804ZM27.9175 30.0429C27.7742 30.1862 27.7042 30.1893 27.7037 30.1894C27.6924 30.1908 27.6284 30.1963 27.4781 30.1212C27.1237 29.944 26.7156 29.5517 26.1443 28.9804L24.7301 30.3946C25.2212 30.8858 25.8756 31.556 26.5837 31.91C26.9647 32.1005 27.4319 32.2389 27.9518 32.1739C28.4826 32.1076 28.9439 31.845 29.3317 31.4571L27.9175 30.0429ZM30.0425 27.9179L27.9175 30.0429L29.3317 31.4571L31.4567 29.3321L30.0425 27.9179ZM30.0425 27.2071C30.154 27.3187 30.1913 27.4008 30.2054 27.445C30.2198 27.4902 30.2227 27.5352 30.2141 27.5878C30.2049 27.6447 30.1817 27.7103 30.1444 27.7774C30.1064 27.8459 30.0651 27.8953 30.0425 27.9179L31.4567 29.3321C31.7469 29.0419 32.0853 28.541 32.1882 27.9091C32.3011 27.2152 32.1122 26.4484 31.4567 25.7929L30.0425 27.2071ZM28.7926 21.8028C28.1597 23.0686 28.1014 24.1659 28.493 25.1448C28.8486 26.0338 29.5436 26.7082 30.0425 27.2071L31.4567 25.7929C30.8931 25.2293 30.5256 24.8412 30.35 24.402C30.2103 24.0529 30.1519 23.5563 30.5815 22.6972L28.7926 21.8028ZM32.3695 20.1852C31.6772 20.1804 30.9508 20.1634 30.3502 20.3569C29.611 20.5952 29.1439 21.1003 28.7926 21.8028L30.5815 22.6972C30.7701 22.32 30.8804 22.2873 30.9638 22.2605C31.1858 22.1889 31.5271 22.1794 32.3555 22.1852L32.3695 20.1852ZM32.8745 20.1875C32.6971 20.1875 32.5301 20.1863 32.3695 20.1852L32.3555 22.1852C32.5154 22.1863 32.6891 22.1875 32.8745 22.1875V20.1875ZM33.9708 18.9873C33.9205 19.6548 33.8011 19.8966 33.7173 19.9906C33.6727 20.0406 33.5173 20.1875 32.8745 20.1875V22.1875C33.7848 22.1875 34.6227 21.9802 35.2099 21.3219C35.7578 20.7076 35.9086 19.8869 35.9651 19.1377L33.9708 18.9873ZM33.9997 17.1105C34.0006 17.6381 34.0013 18.5821 33.9708 18.9873L35.9651 19.1377C36.003 18.635 36.0005 17.5905 35.9997 17.1072L33.9997 17.1105ZM33.9995 16.9375C33.9995 16.9857 33.9996 17.0445 33.9997 17.1105L35.9997 17.1072C35.9996 17.0406 35.9995 16.9836 35.9995 16.9375H33.9995ZM32.8745 15.8125C33.2651 15.8125 33.4848 15.8929 33.6051 15.962C33.7227 16.0295 33.7991 16.1167 33.8559 16.221C33.9898 16.4664 33.9995 16.7691 33.9995 16.9375H35.9995C35.9995 16.7518 36.0092 15.992 35.6117 15.2633C35.403 14.8807 35.081 14.5031 34.6009 14.2275C34.1235 13.9534 33.5464 13.8125 32.8745 13.8125L32.8745 15.8125ZM28.9799 14.457C29.5523 15.0294 30.068 15.4356 30.7595 15.639C31.381 15.8218 32.0812 15.8125 32.8745 15.8125V13.8125C31.9678 13.8125 31.6055 13.8032 31.3239 13.7203C31.1124 13.6581 30.8843 13.533 30.3942 13.0429L28.9799 14.457ZM28.9799 9.85535C28.4121 10.4232 28.0115 11.1796 27.971 12.029C27.9296 12.899 28.2724 13.7495 28.98 14.4571L30.3942 13.0428C30.0392 12.6879 29.9571 12.3697 29.9687 12.1241C29.9814 11.8578 30.112 11.5517 30.3942 11.2695L28.9799 9.85535ZM30.0424 8.08205C30.1858 8.2254 30.1888 8.29539 30.1889 8.29585C30.1903 8.30719 30.1959 8.37121 30.1207 8.52149C29.9435 8.87592 29.5513 9.284 28.9799 9.85535L30.3942 11.2695C30.8853 10.7784 31.5556 10.124 31.9096 9.41591C32.1001 9.03494 32.2384 8.56771 32.1735 8.04779C32.1071 7.517 31.8445 7.05575 31.4567 6.66785L30.0424 8.08205ZM27.9175 5.95705L30.0424 8.08205L31.4567 6.66785L29.3317 4.54285L27.9175 5.95705ZM27.2067 5.95705C27.3183 5.8455 27.4004 5.80828 27.4447 5.79415C27.4898 5.77974 27.5348 5.77684 27.5873 5.78539C27.6443 5.79466 27.7099 5.81784 27.777 5.85516C27.8454 5.89317 27.8948 5.9344 27.9175 5.95705L29.3317 4.54285C29.0415 4.25261 28.5406 3.91425 27.9087 3.81138C27.2148 3.69842 26.448 3.88738 25.7925 4.54285L27.2067 5.95705ZM21.8025 7.20693C23.0683 7.83985 24.1655 7.89816 25.1445 7.50656C26.0334 7.15096 26.7078 6.45594 27.2067 5.95705L25.7925 4.54285C25.2289 5.10643 24.8409 5.47393 24.4017 5.64962C24.0525 5.78929 23.556 5.84763 22.6969 5.41808L21.8025 7.20693ZM20.1852 3.40357C20.1801 3.89464 20.1669 4.61515 20.3347 5.28854C20.5122 6.00128 20.918 6.76468 21.8025 7.20693L22.6969 5.41808C22.4924 5.31581 22.3605 5.14699 22.2754 4.80512C22.1804 4.42391 22.1795 3.96741 22.1851 3.42439L20.1852 3.40357ZM20.1872 3.125C20.1872 3.21194 20.1863 3.30326 20.1852 3.40357L22.1851 3.42439C22.1861 3.32616 22.1872 3.2242 22.1872 3.125H20.1872ZM19.0622 2C19.6915 2 19.8988 2.1856 19.9813 2.28877C20.0979 2.43454 20.1872 2.70061 20.1872 3.125H22.1872C22.1872 2.48689 22.0639 1.69046 21.543 1.03936C20.9881 0.345656 20.1329 2.07336e-06 19.0622 2.02656e-06L19.0622 2ZM24.0833 18C24.0833 21.3597 21.3597 24.0833 18 24.0833V26.0833C22.4643 26.0833 26.0833 22.4643 26.0833 18H24.0833ZM18 11.9167C21.3597 11.9167 24.0833 14.6403 24.0833 18H26.0833C26.0833 13.5357 22.4643 9.91667 18 9.91667V11.9167ZM11.9167 18C11.9167 14.6403 14.6403 11.9167 18 11.9167V9.91667C13.5357 9.91667 9.91667 13.5357 9.91667 18H11.9167ZM18 24.0833C14.6403 24.0833 11.9167 21.3597 11.9167 18H9.91667C9.91667 22.4643 13.5357 26.0833 18 26.0833V24.0833Z"
            fill="black"
          />
        </svg>
        <TextLabelWithAutoHeight
          shape={shape}
          isSelected={isSelected}
          iconHeight={ICON_HEIGHT}
          minHeight={MIN_HEIGHT}
          padding={16}
        />
      </HTMLContainer>
    )
  }

  override indicator(shape: ShapeType) {
    return <rect width={shape.props.w} height={shape.props.h} />
  }
}
